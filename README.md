# ML-модель для геомаркетинга
В данном ноутбуке (Final_model.ipynb) представлена модель на CatBoost (Regressor). Файл model_params.cbm содержит параметры готовой модели. Ноутбук tools_for_bot.ipynb содержит код предобработки датасета, получаемого из парсера, а также вспомогательные функции для реализованных в боте возможностей использования модели.

Код и подробные комментарии процесса содержатся в ноутбуке (Final_model_with_comments.ipynb). Здесь содержится описание.

В ноутбуке torch_model.ipynb приведена модель на Pytorch (предобработка данных выполнена так же, как у модели на CatBoost). В файле model_pars находятся параметры этой модели.
## Загрузка данных и препроцессинг
Сначала происходит чтение данных о расположении магазинов и времени в пути от них до каждого из районов (market-coordinates, filled table, fixed_dist). Каждому из магазинов ставится в соответствие его уникальный ID. 

Затем считывается основная информация о магазинах - тип помещения, информация о количестве посетителей в день и площади магазина (main_data_10). После чего происходит расчет предполагаемого значения посетителей в соответствии с формулой Хаффа, эти данные конкатенируются с данными из main_data_10.

## Краткое описание модели
После препроцессинга удаляются все лишние столбцы, выборка разделяется на тестовую и тренировочную, происходит обучение модели. Сама модель - ансамбль решающих деревьев, на котором выполняется градиентный бустинг, используется метрика MAPE. После этого предсказываются значения на тестовой выборке (и для сравнения на основной выборке тоже), результаты визуализируются. 

# Визуализация полученных результатов
Здесь представлен график предсказаний на тестовой выборке. Синяя линяя - реальные данные, оранжевая - предсказания. Ось Х - номера магазинов.

![image](https://user-images.githubusercontent.com/109974255/233736137-cca684d6-fe1a-46f3-82ad-92dc09e1f6fb.png)

Ниже представлен график предсканий на всём датасете. Синяя линяя - реальные данные, оранжевая - предсказания. Ось Х - номера магазинов. Для удобства восприятия значения реальной посещаемости магазинов отсортированы, а порядок предсказаний изменен в соответствии с порядком сортировки.
Можно видеть, что в целом модель научилась достаточно точно (за исключением некоторых точек) предсказывать число посетителей в день

![image](https://github.com/HSEGeoMarketing/ML-Model/assets/109974255/a610ee62-dae4-4089-b81a-007f254ea9a7)
